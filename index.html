<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>모의주식투자게임 MVP</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#94a3b8;--pos:#16a34a;--neg:#ef4444;--accent:#3b82f6}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif}
    a{color:var(--accent)}
    header,footer,nav,main{max-width:1200px;margin:auto;padding:12px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    .brand{font-weight:700}
    .top-controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn.secondary{background:#334155}
    .grid{display:grid;gap:12px}
    .grid.cols-2{grid-template-columns:repeat(2,1fr)}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:12px}
    .kpi{display:flex;align-items:center;justify-content:space-between}
    .kpi small{color:var(--muted)}
    .pos{color:var(--pos)} .neg{color:var(--neg)}
    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin:10px 0}
    .tab{padding:8px 12px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#cbd5e1;cursor:pointer}
    .tab[aria-selected="true"]{background:#1e293b;border-color:#3b82f6;color:#fff}
    .list{display:flex;flex-direction:column;gap:8px}
    .row{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:10px;background:#0b1220;border:1px solid #1f2937}
    .row .muted{color:var(--muted)}
    .split{display:grid;grid-template-columns:2fr 1fr;gap:12px}
    @media (max-width: 900px){.grid.cols-3{grid-template-columns:1fr}.grid.cols-2{grid-template-columns:1fr}.split{grid-template-columns:1fr}}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    input,select{background:#0b1220;color:#e5e7eb;border:1px solid #334155;border-radius:10px;padding:8px}
    label{display:block;margin:6px 0 4px;color:#cbd5e1}
    .toast{position:fixed;right:12px;bottom:12px;background:#1f2937;color:#fff;padding:10px 12px;border-radius:10px;border:1px solid #334155;display:none}
    .badge{font-size:12px;padding:2px 8px;border-radius:999px;background:#0b1220;border:1px solid #334155;color:#cbd5e1}
    .footer-note{color:#94a3b8;font-size:13px}
  </style>
</head>
<body>
  <a class="sr-only" href="#main">본문 바로가기</a>
  <header role="banner">
    <div class="brand" aria-label="사이트 로고">📈 모의주식투자게임</div>
    <div class="top-controls" role="group" aria-label="상단 도구">
      <label for="date" class="sr-only">날짜 선택</label>
      <input id="date" type="date" aria-label="날짜 선택" />
      <button class="btn secondary" id="a11yToggle" aria-pressed="false">Aa/고대비</button>
      <button class="btn" id="ttsBtn" aria-label="현재 요약 읽기">TTS</button>
      <button class="btn secondary" id="notifBtn">알림 허용</button>
      <button class="btn" id="tutorialBtn">튜토리얼</button>
    </div>
  </header>

  <nav aria-label="주요 섹션" style="max-width:1200px;margin:auto;padding:0 12px 12px;">
    <div class="tabs" role="tablist">
      <button role="tab" class="tab" aria-selected="true" aria-controls="tab-home" id="tab-home-btn">홈</button>
      <button role="tab" class="tab" aria-selected="false" aria-controls="tab-market" id="tab-market-btn">시장</button>
      <button role="tab" class="tab" aria-selected="false" aria-controls="tab-trade" id="tab-trade-btn">거래</button>
      <button role="tab" class="tab" aria-selected="false" aria-controls="tab-portfolio" id="tab-portfolio-btn">포트폴리오</button>
      <button role="tab" class="tab" aria-selected="false" aria-controls="tab-league" id="tab-league-btn">리그</button>
    </div>
  </nav>

  <main id="main" tabindex="-1">
    <!-- 홈 -->
    <section id="tab-home" role="tabpanel" aria-labelledby="tab-home-btn">
      <div class="grid cols-3">
        <div class="card kpi" aria-live="polite">
          <div>
            <div>오늘의 요약</div>
            <small class="muted" id="summaryText">KOSPI ▲0.8%, 테마: 2차전지, 환율 보합</small>
          </div>
          <span class="badge" id="todayBadge">오늘</span>
        </div>
        <div class="card">
          <div class="kpi"><strong>KOSPI</strong><span id="k-kospi" class="pos">▲ 0.8%</span></div>
          <small class="muted">전일 대비</small>
        </div>
        <div class="card">
          <div class="kpi"><strong>KOSDAQ</strong><span id="k-kosdaq" class="neg">▼ 0.5%</span></div>
          <small class="muted">전일 대비</small>
        </div>
      </div>

      <div class="grid cols-2" style="margin-top:12px">
        <div class="card">
          <h2 style="margin:0 0 8px">진행 중 리그</h2>
          <div class="list" id="leagueList" aria-live="polite"></div>
        </div>
        <div class="card">
          <h2 style="margin:0 0 8px">오늘의 미션</h2>
          <div class="list" id="missionList"></div>
        </div>
      </div>
    </section>

    <!-- 시장 -->
    <section id="tab-market" role="tabpanel" aria-labelledby="tab-market-btn" hidden>
      <div class="tabs" role="tablist" aria-label="시장 하위 탭">
        <button class="tab" aria-selected="true" aria-controls="mkt-index" id="tab-mkt-index">지수</button>
        <button class="tab" aria-selected="false" aria-controls="mkt-search" id="tab-mkt-search">종목검색</button>
        <button class="tab" aria-selected="false" aria-controls="mkt-news" id="tab-mkt-news">뉴스</button>
      </div>
      <div id="mkt-index" role="tabpanel" aria-labelledby="tab-mkt-index">
        <div class="grid cols-3" id="indexGrid"></div>
      </div>
      <div id="mkt-search" role="tabpanel" aria-labelledby="tab-mkt-search" hidden>
        <label for="search">종목/심볼 검색</label>
        <input id="search" placeholder="예: 삼성전자, 005930" />
        <div class="list" id="searchResults" style="margin-top:8px"></div>
      </div>
      <div id="mkt-news" role="tabpanel" aria-labelledby="tab-mkt-news" hidden>
        <div class="list" id="newsList"></div>
      </div>
    </section>

    <!-- 거래 -->
    <section id="tab-trade" role="tabpanel" aria-labelledby="tab-trade-btn" hidden>
      <div class="split">
        <div class="card" id="symbolPanel">
          <h2 style="margin:0 0 6px" id="symbolTitle">삼성전자 (005930)</h2>
          <div class="muted" id="symbolPrice">현재가 72,300 (+1.2%)</div>
          <div style="margin-top:10px" class="muted">차트(샘플) · 뉴스 3건 · 재무 스냅샷</div>
        </div>
        <div class="card" aria-label="주문 패널">
          <h2 style="margin:0 0 8px">주문</h2>
          <label for="orderType">주문유형</label>
          <select id="orderType" aria-label="주문유형">
            <option value="market">시장가</option>
            <option value="limit">지정가</option>
          </select>
          <label for="qty">수량</label>
          <input id="qty" type="number" min="1" value="10" />
          <label for="limitPx" id="limitLabel" hidden>지정가</label>
          <input id="limitPx" type="number" step="10" hidden />
          <div style="margin:8px 0" id="orderPreview" class="muted">예상금액: ₩723,000 · 수수료 약 ₩2,169</div>
          <div style="display:flex; gap:8px">
            <button class="btn" id="buyBtn">매수(B)</button>
            <button class="btn secondary" id="sellBtn">매도(S)</button>
          </div>
          <small class="muted">리스크 가드: 주문 한도 2,000,000 / 일손실 한도 -10%</small>
        </div>
      </div>
    </section>

    <!-- 포트폴리오 -->
    <section id="tab-portfolio" role="tabpanel" aria-labelledby="tab-portfolio-btn" hidden>
      <div class="card">
        <h2 style="margin:0 0 8px">자산 요약</h2>
        <div class="grid cols-3">
          <div class="kpi"><span>평가금액</span><strong id="pfValue">₩1,024,300</strong></div>
          <div class="kpi"><span>누적손익</span><strong id="pfPnL" class="pos">+2.4%</strong></div>
          <div class="kpi"><span>현금</span><strong id="pfCash">₩200,000</strong></div>
        </div>
      </div>
      <div class="card" style="margin-top:12px">
        <h2 style="margin:0 0 8px">보유 자산</h2>
        <div role="table" aria-label="보유 자산 표">
          <div role="row" class="row" aria-rowindex="1">
            <div role="columnheader" style="width:30%">종목</div>
            <div role="columnheader" style="width:15%">수량</div>
            <div role="columnheader" style="width:20%">평가금액</div>
            <div role="columnheader" style="width:15%">손익%</div>
            <div role="columnheader" style="width:20%">비중</div>
          </div>
          <div id="pfTable" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <!-- 리그 -->
    <section id="tab-league" role="tabpanel" aria-labelledby="tab-league-btn" hidden>
      <div class="grid cols-2">
        <div class="card">
          <h2 style="margin:0 0 8px">리그 목록</h2>
          <div class="list" id="leagueAll"></div>
        </div>
        <div class="card">
          <h2 style="margin:0 0 8px">랭킹(Top 10)</h2>
          <div class="list" id="rankList"></div>
        </div>
      </div>
    </section>
  </main>

  <footer role="contentinfo">
    <div class="footer-note">교육 목적의 모의투자 서비스 · 데이터는 예시이며 실제 투자에 사용하지 마세요.</div>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // --- 더미 데이터 ---
    const leagues = [
      { title: '3A반 리그', period: '09/01–09/30', myRank: 5 },
      { title: '경제동아리 S1', period: '09/10–10/10', myRank: 12 }
    ];
    const missions = [
      { title: '섹터 4개 이상 분산 달성', reward: '배지 +10XP' },
      { title: '손절가 설정하기', reward: '+5XP' }
    ];
    const indices = [
      { name: 'KOSPI', chg: +0.82 },
      { name: 'KOSDAQ', chg: -0.47 },
      { name: 'S&P500', chg: +0.15 }
    ];
    const holdings = [
      { sym: '005930', name: '삼성전자', qty: 10, value: 723000, pnl: +1.2, weight: 35 },
      { sym: '000660', name: 'SK하이닉스', qty: 3, value: 411000, pnl: -0.8, weight: 20 },
      { sym: '069500', name: 'KODEX200', qty: 5, value: 388000, pnl: +0.5, weight: 18 }
    ];

    // --- 유틸 ---
    const fmt = n => n.toLocaleString('ko-KR');
    function toast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg; t.style.display='block';
      setTimeout(()=>{t.style.display='none'}, 2000);
    }

    // --- 초기 렌더 ---
    function renderHome(){
      const ll = document.getElementById('leagueList');
      ll.innerHTML = leagues.map(l=>`<div class="row"><div><strong>${l.title}</strong><div class="muted">${l.period}</div></div><div>내 순위 <strong>${l.myRank}</strong></div></div>`).join('');
      const ml = document.getElementById('missionList');
      ml.innerHTML = missions.map(m=>`<div class="row"><div><strong>${m.title}</strong><div class="muted">보상: ${m.reward}</div></div><button class="btn secondary" onclick="toast('미션 시작: ${m.title}')">시작</button></div>`).join('');
    }
    function renderMarket(){
      const grid = document.getElementById('indexGrid');
      grid.innerHTML = indices.map(ix=>`<div class="card kpi"><span>${ix.name}</span><strong class="${ix.chg>=0?'pos':'neg'}">${ix.chg>=0?'▲':'▼'} ${Math.abs(ix.chg).toFixed(2)}%</strong></div>`).join('');
      const news = [
        { title:'메모리 업황 개선 기대', source:'머니투데이', time:'10분 전' },
        { title:'원/달러 환율 보합권', source:'연합인포맥스', time:'20분 전' }
      ];
      document.getElementById('newsList').innerHTML = news.map(n=>`<div class="row"><div><strong>${n.title}</strong><div class="muted">${n.source} · ${n.time}</div></div><button class="btn secondary" onclick="toast('저장됨')">저장</button></div>`).join('');
    }
    function renderPortfolio(){
      const el = document.getElementById('pfTable');
      el.innerHTML = holdings.map((h,i)=>`
        <div role="row" class="row" aria-rowindex="${i+2}">
          <div role="cell" style="width:30%">${h.name}<div class="muted">${h.sym}</div></div>
          <div role="cell" style="width:15%">${fmt(h.qty)}</div>
          <div role="cell" style="width:20%">₩${fmt(h.value)}</div>
          <div role="cell" style="width:15%" class="${h.pnl>=0?'pos':'neg'}">${h.pnl>=0?'+':''}${h.pnl}%</div>
          <div role="cell" style="width:20%">${h.weight}%</div>
        </div>`).join('');
    }
    function renderLeague(){
      document.getElementById('leagueAll').innerHTML = leagues.map(l=>`<div class="row"><div><strong>${l.title}</strong><div class="muted">${l.period}</div></div><button class="btn" onclick="toast('참가 코드 전송')">참가</button></div>`).join('');
      document.getElementById('rankList').innerHTML = Array.from({length:10}, (_,i)=>`<div class="row"><div>#${i+1}</div><div>사용자${i+1}</div><div class="pos">+${(Math.random()*10).toFixed(1)}%</div></div>`).join('');
    }

    renderHome(); renderMarket(); renderPortfolio(); renderLeague();

    // --- 탭 전환 ---
    const tabs = ['home','market','trade','portfolio','league'];
    tabs.forEach(name=>{
      document.getElementById(`tab-${name}-btn`).addEventListener('click', ()=>{
        tabs.forEach(n=>{
          const btn = document.getElementById(`tab-${n}-btn`);
          const panel = document.getElementById(`tab-${n}`);
          const active = n===name;
          btn.setAttribute('aria-selected', active);
          panel.hidden = !active;
        });
        document.getElementById(`tab-${name}`).focus();
      });
    });

    // --- 주문 패널 ---
    const orderType = document.getElementById('orderType');
    const limitPx = document.getElementById('limitPx');
    const limitLabel = document.getElementById('limitLabel');
    orderType.addEventListener('change', ()=>{
      const isLimit = orderType.value==='limit';
      limitPx.hidden = !isLimit; limitLabel.hidden = !isLimit;
    });
    document.getElementById('buyBtn').addEventListener('click', ()=> toast('매수 주문이 전송되었어요 (샘플)'));
    document.getElementById('sellBtn').addEventListener('click', ()=> toast('매도 주문이 전송되었어요 (샘플)'));

    // --- 키보드 단축키 ---
    document.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase()==='b') document.getElementById('buyBtn').click();
      if(e.key.toLowerCase()==='s') document.getElementById('sellBtn').click();
      if(e.key.toLowerCase()==='p') document.getElementById('tab-portfolio-btn').click();
      if(e.key.toLowerCase()==='l') document.getElementById('tab-league-btn').click();
    });

    // --- 접근성 토글(고대비 데모) ---
    const a11yBtn = document.getElementById('a11yToggle');
    a11yBtn.addEventListener('click', ()=>{
      const pressed = a11yBtn.getAttribute('aria-pressed')==='true';
      a11yBtn.setAttribute('aria-pressed', String(!pressed));
      document.documentElement.style.setProperty('--bg', pressed?'#0f172a':'#000');
      document.documentElement.style.setProperty('--card', pressed?'#111827':'#000');
      document.documentElement.style.setProperty('--text', pressed?'#e5e7eb':'#fff');
      document.documentElement.style.setProperty('--muted', pressed?'#94a3b8':'#cbd5e1');
    });

    // --- TTS(브라우저 스피치 합성) ---
    document.getElementById('ttsBtn').addEventListener('click', ()=>{
      const text = '오늘의 요약. 코스피 플러스 0.8 퍼센트, 주요 테마 2차 전지, 환율 보합입니다.';
      if('speechSynthesis' in window){
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'ko-KR';
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      } else {
        toast('이 브라우저는 음성 합성을 지원하지 않아요');
      }
    });

    // --- 하위 탭 전환 ---
    function switchSub(parent, name){
      ['index','search','news'].forEach(n=>{
        const btn = document.getElementById(`tab-mkt-${n}`);
        const panel = document.getElementById(`mkt-${n}`);
        const active = n===name;
        btn.setAttribute('aria-selected', active);
        panel.hidden = !active;
      });
    }
    document.getElementById('tab-mkt-index').onclick=()=>switchSub('market','index');
    document.getElementById('tab-mkt-search').onclick=()=>switchSub('market','search');
    document.getElementById('tab-mkt-news').onclick=()=>switchSub('market','news');

    // --- 검색 데모 ---
    document.getElementById('search').addEventListener('input', (e)=>{
      const q = e.target.value.trim();
      const list = [
        {sym:'005930', name:'삼성전자'},
        {sym:'000660', name:'SK하이닉스'},
        {sym:'035420', name:'NAVER'},
        {sym:'005380', name:'현대차'}
      ];
      const res = list.filter(x=>x.name.includes(q) || x.sym.includes(q));
      const box = document.getElementById('searchResults');
      box.innerHTML = res.map(x=>`<div class='row'><div><strong>${x.name}</strong><div class='muted'>${x.sym}</div></div><button class='btn' onclick="selectSymbol('${x.name}','${x.sym}')">선택</button></div>`).join('');
    });

    window.selectSymbol = function(name, sym){
      document.getElementById('tab-trade-btn').click();
      document.getElementById('symbolTitle').textContent = `${name} (${sym})`;
      document.getElementById('symbolPrice').textContent = `현재가 72,300 (+1.2%)`;
      toast(`${name} 선택됨`);
    }

    // 알림 권한 데모
    document.getElementById('notifBtn').onclick = async ()=>{
      if(!('Notification' in window)) return toast('알림 미지원 브라우저');
      const p = await Notification.requestPermission();
      toast(p==='granted'?'알림이 허용되었어요':'알림이 거부되었어요');
    }

    // 튜토리얼 안내
    document.getElementById('tutorialBtn').onclick = ()=>{
      toast('튜토리얼: ①시장 보기 ②가설 세우기 ③소량 매수');
    }
  </script>
</body>
</html>
